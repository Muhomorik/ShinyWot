---
title: "Readme"
author: "Dmitri Peredera"
date: "3 mars 2016"
output: md_document
---

# ShinyWot

Course Project: Shiny Application and Reproducible Pitch

[ShinyApp (when running)](https://muhomorik.shinyapps.io/ShinyWot/) 
[RPubs presentation](http://rpubs.com/Muhomorik/ShinyWot)

<span style="color:red">**Note:** </span>This document is auto-generated by knitr from [Readme.Rmd](Readme.Rmd).

# Abstract #

This is my "pet toy" project. Once upon a time I use to play MMORPG World of Tanks.

The good thind is thet [Wargaming ](https://eu.wargaming.net/developers/documentation/guide/getting-started/) provide an API (json).

So I decided to take a look and make a simple app to perform requests and plot response. The idea was to check how warious types of vehicles perform for the articular player.

I am not very happy with the current results and the signle player data is not enough. So I will keep digging after this course.

# Input #

Only "random" battles are taken.

Choose against some pre-defined players. I've included some:

- Na`Vi (e-sports chamions) players.
- Good SPG players to see different king of stats.
- Russian popular streamers (youtube.com)

Tier

- Most pupular tiers are 7-8 and 10.

In garage

- Take only owned vehicles.

# TODO: #

- [ ] Reorder functions for better re-use in Rmd (here).

# Results #


```{r, init, echo=FALSE, message=F, warning=F}

rm(list=ls())

library(curl)
library(shiny)

library(jsonlite)
library(dplyr)
library(ggplot2)

```

```{r load, echo=FALSE, message=F, warning=F}
source("cfg.R")
token <- GetWgApiKey()

source("LoadTanks.R", local=TRUE)
Vehicles <- LoadTankList(token)

source("LoadStats.R", local=TRUE)
source("Helpers.R", local=TRUE)

account_id <- 486353
inGarage <- TRUE
tier.min <- 6
tier.max <- 10

```

```{r read, echo=FALSE, message=F, warning=F}

# Request
req.fields <- c("tank_id", "random")
req.extra <- "random"

# Load (reactive) and filter data based on input.

url <- CreateUrlVehicleStats("ru", token, 
  req.fields, req.extra, account_id, inGarage)

VehicleStats <- 
  LoadPlayerStats(url)

df <- VehicleStats %>% 
  inner_join(Vehicles, by="tank_id")

df<- filterDf(df, tier.min, tier.max)


```

The result is some charts like 

## WinRate histogram ##

```{r winrateHist, echo=FALSE}

p2 <- ggplot(df, aes(random.battles)) 
p2 <- p2 + geom_histogram(bins = 34, colour="white")
p2 <- p2 + labs(title ="Battles fought histogram", x = "Win ratio", y = "Count")
p2
    
```

## WinRate density and density by tier ##

```{r density, echo=FALSE}

# TODO: this one draws double lines with color!
mean <- mean(df$winRate)

p3 <- ggplot(df, aes(x=winRate)) 
p3 <- p3 + geom_histogram(aes(y=..density..),bins = 32, colour="white")
p3 <- p3 + geom_vline(xintercept = mean, show.legend = TRUE,
                    linetype="dashed", size=1)
p3 <- p3 + labs(title ="Win ratio density", x = "Win ratio", y = "Density")
p3 <- p3 + geom_density(aes(winRate, alpha=.2, color=tier), size=0.5)
p3

```

## Average Dmg vs Win ratio ##

```{r avgDmg_vs_WinRate, echo=FALSE}

p.1 <- ggplot(df, aes(avg.DamageDealt, winRate, label = name)) 
p.1 <- p.1 + geom_point(aes(color = tier))
p.1 <- p.1 + facet_grid(type~.)
p.1 <- p.1 + geom_text(check_overlap = TRUE)
p.1 <- p.1 + geom_smooth(method=lm)
p.1 <- p.1 + labs(title ="Average Dmg vs Win ratio", x = "Damage", y = "Win ratio")
p.1

```

## Spotted vs Win ratio ##

[Spotting](http://wiki.wargaming.net/en/Battle_Mechanics#Spotting_Mechanics) vs Win Ratio


```{r spotted_vs_WinRate, echo=FALSE}

p4 <- ggplot(df, aes(avg.Spotted, winRate, label = name)) 
p4 <- p4 + geom_point(aes(color = tier))
p4 <- p4 + facet_grid(type~.)
p4 <- p4 + geom_text(check_overlap = TRUE)
p4 <- p4 + geom_smooth(method=lm)
p4 <- p4 + labs(title ="Spottd tanks vs Win ratio", x = "Spotted tanks", y = "Win ratio")
p4

```






